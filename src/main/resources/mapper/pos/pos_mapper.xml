<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ustore.pos.dao.PosDao">

		<!-- 현재 멤버쉽 이용 회원 리스트 불러오기 -->
		<select id="posMember" resultType="com.ustore.member.dto.MemberDto">
			   SELECT m.member_idx , m.name ,m.contact_num, mg.grade, c2.common_type 
			   FROM members m
			   LEFT JOIN member_grade mg ON m.grade_idx = mg.grade_idx
			   LEFT JOIN common c2 ON m.member_type = c2.common_idx 
			   WHERE m.member_state = (SELECT c.common_idx FROM common c WHERE common_type='등록된 회원')
		</select>
		
		<!-- 현재 멤버쉽 이용 회원 리스트 검색 -->
		<select id="memberSearch" resultType="com.ustore.member.dto.MemberDto">
			SELECT m.member_idx , m.name ,m.contact_num, mg.grade, c2.common_type 
			FROM members m
			LEFT JOIN member_grade mg ON m.grade_idx = mg.grade_idx
			LEFT JOIN common c2 ON m.member_type = c2.common_idx 
			WHERE m.member_state = (SELECT c.common_idx FROM common c WHERE common_type='등록된 회원')
			AND
			<if test="selectedOption == 'name'">	  	
		   	 m.name =#{searchText}
	  		</if>
	  		<if test="selectedOption == 'contact_num'">
			m.contact_num LIKE CONCAT('%', #{searchText})
			</if>
		</select>
		
		<!-- pos 상품 리스트 불러오기 -->
		<select id="posItem" resultType="com.ustore.pos.dto.PosDto">
			   SELECT p.product_id ,p.product_name ,p.selling_price ,p.stock FROM products p WHERE p.stock != 0
		</select>
		
		<!-- pos 회원 장바구니 리스트 불러오기 -->
		<select id="posCart" resultType="com.ustore.pos.dto.PosDto">
			SELECT c.quantity , p.selling_price, p.product_name, p.product_id,(p.selling_price * c.quantity)AS selling_sum  
			FROM  products p
			LEFT JOIN payment_cart c ON c.product_id = p.product_id
			WHERE c.member_id = #{param1}
		</select>
		
		<!-- pos 회원이 장바구니 변경/업데이트 -->
		<update id="updateCart">
			UPDATE payment_cart SET quantity =#{quantity} WHERE member_id =#{memberId} AND product_id =#{productId}
		</update>
		
		<!-- pos 회원이 장바구니 담기 -->
		<insert id="posCartInsert">
			INSERT INTO payment_cart (product_id,member_id,quantity) VALUES (#{productId},#{memberId},#{quantity})
		</insert>
		
		<!-- pos 장바구나 담기 취소 -->
		<delete id="deleteCart">
			DELETE FROM payment_cart WHERE member_id =#{memberId} AND product_id = #{productId}
		</delete>
		
		<!-- pos 수량 여부 확인 -->
		<select id="selQuantity" resultType="int">
			SELECT stock FROM products p2 WHERE product_id =#{productId}
		</select>

		<!-- pos 장바구니 동일 제품 여부 확인 -->
		<select id="selInsert" resultType="String">
			SELECT payment_cart_idx FROM payment_cart pc WHERE member_id =#{memberId} AND product_id =#{productId}
		</select>
		
		<!-- pos 물품 검색 -->
		<select id="productSearch" resultType="com.ustore.pos.dto.PosDto">
			SELECT p.product_id ,p.product_name ,p.selling_price ,p.stock FROM products p WHERE p.stock != 0
			AND
			<if test="selectedOption == 'productName'">
			product_name = #{searchText}
			</if>
			<if test="selectedOption == 'productId'">
			product_id = #{searchText}
			</if>
		</select>









</mapper>